# Биндлесс

В данном задании вам предстоит побороть проблему невозможность объединения отрисовки всех элементов сцены в один единый дроу-колл при помощи массивов дескрипторов.

## Перед началом

1. Скопируйте в эту папку ваш текущий рендерер из предыдущих домашек.
В идеале он должен включать решение задачи [pbr](/tasks/pbr/).
2. Если у вас нет решения [pbr](/tasks/pbr/), прикрутите к рендеру текстуры.
Поддерживать PBR не обязательно, достаточно использовать текстуру альбедо.
Для этого загрузите все текстуры сцены на GPU и биндите их в отдельный дескриптор сет, меняющийся для каждого `RenderElement`.

## Задание

Сделайте так, чтобы для доступа к текстурам из шейдеров не приходилось выставлять новый дескриптор-сет для отрисовки каждого отдельного `RenderElement`.
Для этого используйте массивы дескрипторов произвольной длинны и динамическое индексирование дескрипторов, и если нужно &mdash; неуниформное индексирование.

1. Создайте отдельный дескриптор-сет с одним единственным биндингом внутри &mdash; массивом всех текстур сцены.
Заметим, что пересоздавать этот дескриптор-сет каждый кадр нужды нет.
2. При отрисовке `RenderElement` биндите этот дескриптор-сет в новый слот.
Далее, прокиньте в шейдеры новый униформный буфер, содержащий соответствие индексов `RenderElement` сцены индексам текстур которые для них нужно использовать.
Номер рендер-элемента можете прокидывать, например, через пуш-константы.
3. Перепишите шейдер отрисовки сцены чтобы он принимал массив биндлес-текстур и брал текстуру именно из него по индексу из буфера.
4. Проверьте, что всё работает.
Помните, что при неуниформном индексировании необходимо пользоваться аннотацией `nonuniformEXT`.
Если её забыть &mdash; полезут артефакты.

Наконец, объедините по максимуму вызовы отрисовки `RenderElement` при помощи `vkCmdDrawIndexedIndirect`.
Если вы до сих пор этого не сделали, вам придётся загрузить параметры каждого `RenderElement` в буфер на GPU.
Также придётся включить фичу `multiDrawIndirect` в вулкане.
Номер рендер-элемента при этом можно будет доставать из `gl_DrawID`.

В идеале в итоге у вас должен получится ровно один вызов `vkCmdDrawIndexedIndirect`, рисующий всю сцену, но с разными текстурами на разных рендер-элементах.

Если вы подружите эту задачу с куллингом, вам полагается **1 бонусный балл**.
Если с GPU-куллингом, то **2 бонусных балла**.

## Бонусный уровень

Разберитесь самостоятельно с расширением `VK_EXT_descriptor_buffer` и реализуйте биндлесс через него.

## Полезные материалы

1. https://docs.vulkan.org/samples/latest/samples/extensions/descriptor_indexing/README.html &mdash; подробное введение в биндлесс из документации вулкана.