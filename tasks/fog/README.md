# Туман

В данном задании вам предстоит добавить в вашу сцену туман.

## Перед началом

 1. Скопируйте в эту папку любой семпл уже рисующий что-то, обязательно имеющее карту теней.
 2. Если карты теней у вас нет, сделайте наивные тении по аналогии с семплом [shadowmap](/samples/shadowmap/).

## Задание

#### Шаг 1

Добавьте трассировку процедурно сгенерированного тумана в половине разрешения экрана.
Далее предложена общая схема как это реализовать, но её изменение не возбраняется, главное &mdash; чтобы было красиво.
Заметим, что предложенная схема должна давать эффект "божественных лучей", если у вас его не получилось &mdash; вы что-то сделали не так.

В каждом пикселе разбивайте расстояние от камеры до ближайшего объекта на фиксированное количество шагов и проверяйте видимость солнца в них через карту теней.
Вычисляйте в каждой точке процент света солнца рассеянный в направлении камеры.
Суммируйте вклады каждой точки с с правильными коэффициентами чтобы приблизить "честный" интеграл.
Учитывайте в своих вычислениях поглощение света в зависимости от плотности тумана.
Не забудьте убедиться, что матожидание вашей оценки интеграла не зависит от количества шагов.
"Апскейл" итоговой картинки в полное разрешение экрана делайте наивной билинейной фильтрацией.
Накладывайте туман в резолве G-буфера либо в пост-эффектах.

#### Шаг 2

Сделайте функцию плотности тумана зависимой от времени.
Например, симулируйте движение тумана под воздействием ветра.

Не забудьте добавьте в ImGui различные ручки для регулировки свойств плотности тумана, а также настройки качества трассировки, чтобы компьютер проверяющего не взорвался от ваших заточенных под RTX4090 констант.

## Бонусный уровень

Замените скайбокс на процедурно сгенерированную на старте программы кубмапу интеграла атмосферы земли на уровне моря.
Используйте рассеивания Рейли/Ми.

## Полезные материалы

 1. https://www.youtube.com/watch?v=ddfEnuXZijM &mdash; отрисовка вольюметриков в Frostbite
 2. https://media.contentapi.ea.com/content/dam/eacom/frostbite/files/s2016-pbs-frostbite-sky-clouds-new.pdf &mdash; отрисовка атмосферы и облаков в Frostbite
 3. https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering &mdash; про рендеринг атмосферы
