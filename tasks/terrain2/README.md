# Террейн 2

В данном задании мы наконец-то натянем текстуры на наш ландшафт.

## Перед началом

 1. Скопируйте в эту папку решение [terrain](/tasks/terrain/).
Если его у вас нет, то извините.

## Задание

#### Шаг 1

Реализуйте сплаттинг прямо в пиксельном шейдере террейна.
Вариативность тут огромная, поэтому проявите фантазию.
Чем интереснее сделаете &mdash; тем больше баллов получите.
Минимальный вариант:

- Найдите в интернете 4 тайлящихся текстуры дитейла вместе с картами высот.
- Сгенерируйте рядом с картой высот всего террейна маску для сплаттинга.
Например, выбирайте дитейл в зависимости от высоты: снег наверху, трава посередине, песок у уровня моря, гравий под водой (которая будет добавлена в следующих домашках), а между ними плавный переход.
- В пиксельном шейдере террейна семплируйте маску и дитейлы, используя эти значения чтобы покрасить террейн в соответствующий цвет.
- При смешивании учитывайте карты высот дитейлов, чтобы избежать уродливого наложения текстур.
- Нормали генерируйте как разности высот в соседних точках карты высот дитейла.

Обязательно сделайте коммит справившись с этим шагом, чтобы потом можно было сравнить производительность.

Дополнительно можете реализовать флоумап, биомы, трипланарную проекцию, и так далее.

#### Шаг 2

Замените сплаттинг прямо при рендеринге террейна на клипмапу.

- Сделайте несколько каскадов клипмапы с одинаковым разрешением (но разным размером в мире).
- Обновляйте все каскады целиком и полностью как только игрок сдвигается более чем на константу от прошлой точки обновления.
- При обновлении рендерьте с помощью пиксельного или компьют шейдера в клипмапу текстуру террейн при помощи сплаттинга.
- При рендеринге террейна, берите цвет из каскада клипмапы, в который попадает текущий фрагмент.

По завершению этого шага сравните перф рендеринга террейна с прошлым шагом.
Стало ли быстрее? Насколько?

Для дополнительных баллов используйте более грубые каскады в качестве MIP-уровней для целевого каскада, делая при этом корректное усреднение по пикселям дитейлов при обновлении клипмапы (либо в ручную, либо используя MIP-уровни дитейлов).

Ещё для дополнительных баллов можете использовать *дисплейсмент* &mdash; генерировать карту высот террейна также при помощи клипмапы, но дополнительно вбленживать в шум перлина высоты дитейлов.

## Бонусный уровень

Сделайте обновление клипмапы тороидальным.

## Полезные материалы

 1. https://developer.nvidia.com/gpugems/gpugems2/part-i-geometric-complexity/chapter-2-terrain-rendering-using-gpu-based-geometry &mdash; про клипмапы и рендеринг террейна
