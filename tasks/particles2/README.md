# Частицы 2


**Зависимости: [particles](/tasks/particles/)**.

В данном задании нам предстоит продолжить развивать свою систему частиц.


## Перед началом

 1. Скопируйте в данную папку решение задания [частицы](/tasks/particles/).

## Задание

Перенесите симуляцию частиц с CPU на GPU.
В базовом варианте необходимо чтобы:
- Буферы для частиц были свои для каждого эмиттера
- Спавн новых частиц требовал минимум трафика CPU -> GPU
- Симуляция уже существующих частиц (движения по вектору скорости) производилась в компьют-шейдере
- Сортировка частиц перед отрисовкой делалась компьют-шейдером
- Отрисовка шла через draw indirect на каждый эмиттер

Не забудьте, что ваша система как-то должна справляться с "удалением" умерших частиц из середины буфера.

## Бонусный уровень

Реализуйте что-либо из следующего.

 1. Сортировка за $O(n \log n)$
 2. Фрустум-куллинг на GPU перед сортировкой
 3. Окклюжен-куллинг на GPU посредством иерархического Z-буфера (HiZ) текущего кадра перед сортировкой
 4. Окклюжен-куллинг, но вместо HiZ текущего кадра используйте HiZ прошлого кадра и репроекцию
 5. Физику коллизий частиц с остальной геометрией экрана посредством семплирования Z-буфера
 6. Физику коллизий частиц друг с другом посредством пространственной хэш-таблицы
 7. Сделайте унифицированный буфер для хранения данных партиклов всех эмиттеров и его дефрагментацию
 8. Отрисовка всех частиц скопом через multi draw indirect

## Полезные материалы

 1. https://developer.nvidia.com/gpugems/gpugems2/part-vi-simulation-and-numerical-algorithms/chapter-46-improved-gpu-sorting &mdash; сортировки на GPU
 2. https://www.gdcvault.com/play/1025132/Frostbite-GPU-Emitter-Graph &mdash; "новая" система партиклов Frostbite
 3. https://www.youtube.com/watch?v=D2M8jTtKi44 &mdash; коллизии партиклов и пространственные хэш-таблицы
 4. https://www.cs.princeton.edu/courses/archive/spr01/cs598b/papers/greene93.pdf &mdash; иерархический Z-буфер
 5. https://gist.github.com/pixelmager/9d7917213fb135d3dc54e29539000db6 &mdash; список выступлений о частицах с различных конференций от крупных компаний
